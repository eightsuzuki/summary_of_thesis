# SA: Simulated Annealing（焼きなまし法）

**焼きなまし法（Simulated Annealing, SA）**は、金属の焼きなまし処理を模倣したメタヒューリスティック最適化手法です。高温から徐々に温度を下げながら、悪い解も一定の確率で受け入れることで、局所最適解を回避し、より良い解を見つけます。

---

### 1. 基本的なアイデア

**焼きなましのメタファー**:
- **温度（Temperature）**: 探索の自由度を制御するパラメータ
- **冷却スケジュール**: 温度を徐々に下げる過程
- **確率的受理**: 悪い解も温度に応じた確率で受理
- **平衡状態**: 各温度で十分に探索を行う

---

### 2. アルゴリズムの流れ

```
1. 初期解 x を生成
2. 初期温度 T を設定
3. 終了条件を満たすまで繰り返し:
   a. 現在の解 x の近傍から新しい解 x' を生成
   b. 解の改善量 ΔE = f(x') - f(x) を計算
   c. 解を受理するか決定:
      - ΔE < 0 なら受理（改善）
      - ΔE ≥ 0 なら確率 P = exp(-ΔE/T) で受理
   d. 受理した場合、x ← x'
   e. 温度を更新（冷却）
4. 最良解を返す
```

---

### 3. 数式による定式化

#### 3.1 受理確率

新しい解 \(x'\) を受理する確率：
\[
P(\text{accept } x') = \begin{cases}
1 & \text{if } \Delta E < 0 \text{ (改善)} \\
\exp\left(-\frac{\Delta E}{T}\right) & \text{if } \Delta E \geq 0 \text{ (悪化)}
\end{cases}
\]

ここで：
- \(\Delta E = f(x') - f(x)\): 目的関数の変化量
- \(T\): 現在の温度

#### 3.2 冷却スケジュール

**線形冷却**:
\[
T(t+1) = T(t) - \alpha
\]

**指数冷却**:
\[
T(t+1) = \alpha \cdot T(t)
\]

**逆比例冷却**:
\[
T(t) = \frac{T_0}{1 + t}
\]

ここで：
- \(T_0\): 初期温度
- \(\alpha\): 冷却率（通常0.8～0.99）
- \(t\): 反復回数

#### 3.3 平衡状態

各温度 \(T\) で、十分な数の解を試行して平衡状態に達する：
\[
\text{平衡条件}: \text{一定回数の受理または試行}
\]

---

### 4. XAIへの応用

#### 4.1 特徴選択

**問題**: どの特徴が予測に重要かを見つける

**SAの適用**:
- **解**: 特徴の選択パターン
- **近傍操作**: 特徴の追加・削除・交換
- **目的**: 少ない特徴で高い性能を達成

#### 4.2 説明の最適化

**問題**: 最適な説明を生成する

**SAの適用**:
- **解**: 説明の候補（特徴の重み、ルールなど）
- **近傍操作**: 説明の微調整
- **目的**: 高品質な説明を見つける

#### 4.3 ルール抽出

**問題**: 最適なルールセットを見つける

**SAの適用**:
- **解**: ルールセット
- **近傍操作**: ルールの追加・削除・修正
- **目的**: 高精度で簡潔なルールセットを見つける

---

### 5. 利点と欠点

**利点**:
- 実装が簡単
- 局所最適解を回避できる
- パラメータが少ない
- 汎用性が高い

**欠点**:
- 収束が遅い場合がある
- 冷却スケジュールの調整が必要
- 最適解の保証がない
- 高次元問題では性能が低下する場合がある

---

### 6. 実装上の注意点

- **初期温度**: 高い確率で悪い解を受理できる温度に設定
- **冷却率**: 通常0.8～0.99（ゆっくり冷却）
- **平衡条件**: 各温度で十分な探索を行う
- **終了条件**: 温度が十分に低くなったら終了

---

### 7. バリエーション

- **標準SA**: 上記の基本アルゴリズム
- **Adaptive SA**: 冷却スケジュールを適応的に調整
- **Parallel SA**: 複数の解を並列に探索
- **Quantum SA**: 量子アニーリングの概念を組み合わせ

---

### 8. まとめ

焼きなまし法は、金属の焼きなまし処理を模倣した直感的で効果的な最適化手法です。XAIにおいては、特徴選択、説明の最適化、ルール抽出などに応用されています。実装が簡単で局所最適解を回避できるため、実用的な手法として広く使われています。

