# Conjugate Gradient: 共役勾配法

**共役勾配法（Conjugate Gradient, CG）**は、勾配降下法を改良した局所探索手法で、共役方向を使用することで、より効率的に最小値に収束します。特に二次関数の最小化において、有限回の反復で最適解に到達することが保証されています。

---

### 1. 基本的なアイデア

**共役方向**:
- **共役性**: 方向ベクトルが行列に対して共役
- **直交性**: 各方向での最適化が独立
- **有限収束**: 二次関数では \(n\) 回の反復で最適解

---

### 2. アルゴリズムの流れ

```
1. 初期点 x_0 を設定
2. 初期方向 d_0 = -∇f(x_0) を設定
3. 終了条件を満たすまで繰り返し:
   a. 直線探索で最適ステップサイズ α_t を求める
   b. x_{t+1} = x_t + α_t d_t で更新
   c. 勾配 g_{t+1} = ∇f(x_{t+1}) を計算
   d. 共役係数 β_t を計算
   e. 共役方向 d_{t+1} = -g_{t+1} + β_t d_t を更新
4. 最適解 x* を返す
```

---

### 3. 数式による定式化

#### 3.1 二次関数の最小化

二次関数：
\[
f(x) = \frac{1}{2} x^T A x - b^T x
\]

ここで、\(A\) は正定値対称行列。

#### 3.2 共役方向

方向ベクトル \(d_i, d_j\) が \(A\) に対して共役：
\[
d_i^T A d_j = 0 \quad \text{for } i \neq j
\]

#### 3.3 共役係数（Fletcher-Reeves）

\[
\beta_t = \frac{\|\nabla f(x_{t+1})\|^2}{\|\nabla f(x_t)\|^2}
\]

#### 3.4 更新式

\[
\begin{aligned}
x_{t+1} &= x_t + \alpha_t d_t \\
d_{t+1} &= -\nabla f(x_{t+1}) + \beta_t d_t
\end{aligned}
\]

---

### 4. XAIへの応用

#### 4.1 説明の最適化

**問題**: 最適な説明を生成する

**Conjugate Gradientの適用**:
- **目的関数**: 説明の品質（二次近似可能）
- **変数**: 説明のパラメータ
- **共役方向**: 効率的な探索方向
- **目的**: 高品質な説明を見つける

#### 4.2 特徴の重要度の推定

**問題**: 特徴の重要度を推定する

**Conjugate Gradientの適用**:
- **目的関数**: 予測誤差（二次近似）
- **変数**: 特徴の重み
- **共役方向**: 効率的な最適化
- **目的**: 特徴の重要度を推定

#### 4.3 反事実説明の生成

**問題**: 予測を変える最小の変更を見つける

**Conjugate Gradientの適用**:
- **目的関数**: 予測の変化量 + 変更のコスト
- **変数**: 入力の変更量
- **共役方向**: 効率的な探索
- **目的**: 最小の変更で予測を変える

---

### 5. 利点と欠点

**利点**:
- 二次関数では有限回で収束
- メモリ使用量が少ない（\(O(n)\)）
- 収束が比較的速い
- 大規模問題にも適用可能

**欠点**:
- 非二次関数では有限収束が保証されない
- 条件数が大きいと収束が遅い
- 実装がやや複雑

---

### 6. 実装上の注意点

- **共役係数**: Fletcher-Reeves、Polak-Ribièreなど
- **直線探索**: 正確な直線探索が重要
- **再スタート**: 定期的に再スタートすることで性能向上
- **前処理**: 前処理により条件数を改善

---

### 7. バリエーション

- **Fletcher-Reeves**: 上記の基本形
- **Polak-Ribière**: 共役係数の別の計算方法
- **非線形CG**: 非二次関数への拡張
- **前処理CG**: 前処理を適用したバージョン

---

### 8. 参考文献

- Hestenes, M. R., & Stiefel, E. (1952). Methods of conjugate gradients for solving linear systems. *Journal of Research of the National Bureau of Standards*, 49(6), 409-436.
- Fletcher, R., & Reeves, C. M. (1964). Function minimization by conjugate gradients. *The Computer Journal*, 7(2), 149-154.

---

### 9. まとめ

共役勾配法は、共役方向を使用することで効率的に最適化する局所探索手法です。XAIにおいては、説明の最適化、特徴の重要度の推定、反事実説明の生成などに応用されています。メモリ使用量が少なく、大規模問題にも適用できるため、実用的な手法として広く使われています。

