# Branch and Bound: 分枝限定法

**分枝限定法（Branch and Bound, B&B）**は、組合せ最適化問題の最適解を保証する厳密探索手法です。問題を部分問題に分割（分枝）し、各部分問題の上界・下界を計算して、最適解が存在しない部分問題を削除（限定）することで、探索空間を効率的に削減します。

---

### 1. 基本的なアイデア

**分枝と限定**:
- **分枝（Branching）**: 問題をより小さな部分問題に分割
- **限定（Bounding）**: 各部分問題の上界・下界を計算
- **削除（Pruning）**: 最適解が存在しない部分問題を削除
- **探索**: 残った部分問題を系統的に探索

---

### 2. アルゴリズムの流れ

```
1. 初期問題をキューに追加
2. 現在の最良解（上界）を初期化
3. キューが空になるまで繰り返し:
   a. キューから問題を選択
   b. 問題の下界を計算
   c. 下界 ≥ 上界 なら削除（限定）
   d. 問題が十分小さいなら、直接解く
   e. そうでなければ、問題を分割してキューに追加
4. 最良解を返す
```

---

### 3. 数式による定式化

#### 3.1 問題の定義

最小化問題：
\[
\min_{x \in \mathcal{X}} f(x)
\]

ここで、\(\mathcal{X}\) は実行可能領域。

#### 3.2 下界の計算

部分問題 \(P_i\) の下界 \(LB(P_i)\):
\[
LB(P_i) \leq \min_{x \in \mathcal{X}_i} f(x)
\]

#### 3.3 上界の更新

現在の最良解 \(x^*\) の目的関数値が上界：
\[
UB = f(x^*)
\]

#### 3.4 限定条件

部分問題 \(P_i\) が削除される条件：
\[
LB(P_i) \geq UB
\]

---

### 4. XAIへの応用

#### 4.1 特徴選択

**問題**: どの特徴が予測に重要かを見つける（最小特徴数で最大性能）

**Branch and Boundの適用**:
- **部分問題**: 特徴の部分集合
- **下界**: 選択された特徴での性能の下界
- **上界**: 現在の最良特徴集合の性能
- **目的**: 最適な特徴集合を見つける

#### 4.2 説明の最適化

**問題**: 最小の特徴で最適な説明を生成する

**Branch and Boundの適用**:
- **部分問題**: 説明の候補（特徴の組み合わせ）
- **下界**: 説明の品質の下界
- **上界**: 現在の最良説明の品質
- **目的**: 最適な説明を見つける

#### 4.3 ルール抽出

**問題**: 最小のルール数で最大の精度を達成する

**Branch and Boundの適用**:
- **部分問題**: ルールの部分集合
- **下界**: ルール集合の性能の下界
- **上界**: 現在の最良ルール集合の性能
- **目的**: 最適なルール集合を見つける

---

### 5. 利点と欠点

**利点**:
- 最適解が保証される
- 探索空間を効率的に削減できる
- 部分問題の並列化が可能

**欠点**:
- 問題サイズが大きい場合、計算コストが高い
- 下界の計算が難しい場合がある
- 最悪ケースでは全探索と同等の計算量

---

### 6. 実装上の注意点

- **分枝戦略**: どの変数で分枝するかが重要
- **下界の計算**: 緩和問題（線形緩和など）を利用
- **探索順序**: 深さ優先、幅優先、最良優先など
- **上界の初期化**: ヒューリスティック解から開始

---

### 7. 参考文献

- Land, A. H., & Doig, A. G. (1960). An automatic method of solving discrete programming problems. *Econometrica*, 28(3), 497-520.
- Lawler, E. L., & Wood, D. E. (1966). Branch-and-bound methods: A survey. *Operations Research*, 14(4), 699-719.

---

### 8. まとめ

分枝限定法は、最適解を保証する強力な厳密探索手法です。XAIにおいては、特徴選択、説明の最適化、ルール抽出などに応用されています。探索空間を効率的に削減できるため、中規模の問題に対して実用的です。

