# IG2: Integrated Gradient on Iterative Gradient Path for Feature Attribution

**著者**: Yue Zhuo, Zhiqiang Ge  
**会議**: IEEE Transactions on Pattern Analysis and Machine Intelligence (TPAMI)  
**年**: 2024  
**arXiv**: arXiv:2406.10852  
**DOI**: 10.48550/arXiv.2406.10852  
**URL**: [https://arxiv.org/abs/2406.10852](https://arxiv.org/abs/2406.10852)  
**GitHub**: [https://github.com/joezhuo-zy/ig2](https://github.com/joezhuo-zy/ig2)

---

## 概要

IG2は、Integrated Gradients (IG) を拡張した特徴アトリビューション手法です。既存のIG変種は主に説明対象（explicand）の出力の勾配に焦点を当てていましたが、本論文では**反事実（counterfactual、ベースライン）の出力の勾配も特徴アトリビューションに大きく影響する**ことを示し、両方の勾配を考慮する**Iterative Gradient path Integrated Gradients (IG2)** を提案しています。

---

## 問題の背景

### 既存IG手法の限界

既存のIG変種には以下の問題があります：

1. **アトリビューションノイズ**: 予測クラスに関連しない領域でノイズの多いアトリビューションを生成
2. **任意のベースライン選択**: ベースラインの選択が恣意的で、説明の質に大きく影響する

### 本論文の洞察

本論文では、**反事実（ベースライン）の出力の勾配も特徴アトリビューションに大きく影響する**ことを発見しました。これにより、両方の勾配を考慮することで、より正確なアトリビューションが得られることを示しています。

---

## 主要な貢献

### 1. IG2の提案

**Iterative Gradient path Integrated Gradients (IG2)** は、説明対象の勾配と反事実の勾配の両方を考慮する手法です：

- **説明対象の勾配**: 説明対象（explicand）の出力に対する勾配
- **反事実の勾配**: 反事実（counterfactual、ベースライン）の出力に対する勾配

### 2. 2つの新しいコンポーネント

IG2は、以下の2つの新しいコンポーネントを導入しています：

#### GradPath（反復的な勾配経路）

**提案手法の核心**: 「入力データ（例：犬の画像）」から「反事実データ（例：犬ではないと判断される画像）」へ向かう特別な経路（GradPath）を生成し、その上で積分を行います。

**具体的な動作**:
- 入力画像からスタートし、「反事実クラス（Counterfactual Class）」の勾配に従って少しずつ画像を変化させていきます
- 単に直線で変化させるのではなく、モデルが「これは別のクラスだ」と判断する方向へ、特徴空間上の距離を保ちながら移動します
- これにより、予測に寄与しない背景ノイズなどを無視し、重要な特徴（犬の体など）だけを通る経路を作ることができます

#### GradCF（勾配に基づく反事実ベースライン）

**ベースラインの生成**:
- GradPathの終点（行き着いた先）を新しいベースライン（GradCF）として使用します
- これは「真っ黒な画像」ではなく、入力画像に非常に似ているが、モデルにとっては「別のクラス」に見える画像です
- これと比較することで、「ここがこう違うから犬なんだ」という決定的な差分を抽出できます

**従来のベースラインとの違い**:
- **従来のベースライン（例：ゼロベクトル、黒画像）**: 入力画像と大きく異なり、分布外（OOD）の問題が発生
- **GradCF**: 入力画像に非常に似ているが、モデルにとっては「別のクラス」に見える画像であり、より意味のある比較が可能

### 3. 問題の解決

IG2の2つの新しいコンポーネントは、既存IG手法の以下の問題を効果的に解決します：

- **アトリビューションノイズ**: GradPathにより、より意味のある経路が構築され、ノイズが削減される
- **任意のベースライン選択**: GradCFにより、より適切なベースラインが選択される

---

## 技術的な詳細

### 提案手法：IG² (Iterative Gradient path Integrated Gradients)

この手法の核心は、「入力データ（例：犬の画像）」から「反事実データ（例：犬ではないと判断される画像）」へ向かう特別な経路（GradPath）を生成し、その上で積分を行う点です。具体的には以下の2つの要素で構成されています。

### 1. GradPath（反復的な勾配経路）

**動作原理**:
- 入力画像からスタートし、「反事実クラス（Counterfactual Class）」の勾配に従って少しずつ画像を変化させていきます
- 単に直線で変化させるのではなく、モデルが「これは別のクラスだ」と判断する方向へ、特徴空間上の距離を保ちながら移動します
- これにより、予測に寄与しない背景ノイズなどを無視し、重要な特徴（犬の体など）だけを通る経路を作ることができます

**従来の直線経路との違い**:
- **従来のIG**: ベースラインから入力への直線経路を使用 → 背景ノイズなども経路に含まれる
- **GradPath**: モデルが「別のクラス」と判断する方向へ移動 → 重要な特徴だけを通る経路

### 2. GradCF（勾配に基づく反事実ベースライン）

**ベースラインの生成**:
- GradPathの終点（行き着いた先）を新しいベースライン（GradCF）として使用します
- これは「真っ黒な画像」ではなく、入力画像に非常に似ているが、モデルにとっては「別のクラス」に見える画像です
- これと比較することで、「ここがこう違うから犬なんだ」という決定的な差分を抽出できます

**従来のベースラインとの違い**:
- **従来のベースライン（例：ゼロベクトル、黒画像）**: 入力画像と大きく異なり、分布外（OOD）の問題が発生
- **GradCF**: 入力画像に非常に似ているが、モデルにとっては「別のクラス」に見える画像であり、より意味のある比較が可能

### IG2のアルゴリズム

IG2は、反事実の勾配を反復的に組み込むことで、新しい積分経路（GradPath）を生成します：

1. **初期化**: 説明対象とベースラインを設定
2. **GradPathの生成**: 反事実クラスの勾配に従って、反復的に画像を変化させ、新しい経路を生成
3. **GradCFの決定**: GradPathの終点を新しいベースライン（GradCF）として決定
4. **積分計算**: 生成された経路（GradPath）に沿って勾配を積分

### 公理的性質

IG2は、パス法として多くの望ましい公理を満たします。これらの公理は、論文で理論的に正当化されています。

---

## 実験と評価

### 実験設定

**データセット**:
- XAI benchmark
- ImageNet
- MNIST
- TREC question answering
- Wafer-map failure patterns
- CelebA face attributes

**評価方法**:
- 定性的評価（サリエンシーマップの視覚的評価）
- 定量的評価（複数の評価指標）

### 主要な結果

IG2は、以下のデータセットで、最先端の手法と比較して優れた特徴アトリビューションを提供することが示されました：

- **XAI benchmark**: 既存手法を上回る性能
- **ImageNet**: 画像分類タスクで優れた性能
- **MNIST**: 手書き数字認識タスクで優れた性能
- **TREC question answering**: 質問応答タスクで優れた性能
- **Wafer-map failure patterns**: 製造業の異常検出タスクで優れた性能
- **CelebA face attributes**: 顔属性認識タスクで優れた性能

---

## 論文の意義と影響

### 1. 反事実勾配の重要性の発見

本論文の最大の貢献は、**反事実（ベースライン）の出力の勾配も特徴アトリビューションに大きく影響する**ことを発見したことです。これにより、より正確なアトリビューションが得られるようになりました。

### 2. 新しい経路とベースライン選択

**GradPath**と**GradCF**の導入により、既存IG手法の2つの主要な問題（アトリビューションノイズと任意のベースライン選択）を解決しました。

### 3. 実用的な改善

IG2は、複数のデータセットとタスクで、既存手法を上回る性能を示しており、実用的な改善を提供しています。

---

## 限界と今後の課題

### 1. 計算コスト

- **反復的勾配組み込み**: 反事実の勾配を反復的に組み込むため、計算コストが増加する可能性
- **最適化**: より効率的な計算方法の開発が課題

### 2. 一般化

- **ドメイン依存性**: 異なるドメイン（画像、テキスト、時系列など）での性能の検証が必要
- **モデル依存性**: 異なるアーキテクチャでの性能の検証が必要

### 3. 理論的理解

- **経路選択の理論**: 最適な経路選択の理論的理解が課題
- **ベースライン選択の理論**: 最適なベースライン選択の理論的理解が必要

---

## 実践的な示唆

### 1. アトリビューション手法の選択

- **ノイズが問題となる場合**: IG2は、既存IG手法よりも優れたアトリビューションを提供
- **ベースライン選択が困難な場合**: GradCFにより、より適切なベースラインが選択される
- **実装**: 実用的な実装が利用可能（GitHub）

### 2. 評価方法

- **定性的評価**: 視覚的な評価が重要
- **定量的評価**: 複数の評価指標を使用することが推奨される
- **複数のデータセット**: 異なるデータセットでの評価が重要

### 3. 実装時の注意点

- **計算効率**: 反復的勾配組み込みには注意が必要
- **ベースライン選択**: GradCFの使用を推奨
- **経路の構築**: GradPathの構築には注意が必要

---

## まとめ

「IG2: Integrated Gradient on Iterative Gradient Path for Feature Attribution」は、Integrated Gradients (IG) を拡張した重要な研究です。既存のIG変種が主に説明対象の出力の勾配に焦点を当てていたのに対し、本論文では**反事実（ベースライン）の出力の勾配も特徴アトリビューションに大きく影響する**ことを示し、両方の勾配を考慮する**IG2**を提案しています。

**GradPath**と**GradCF**の導入により、既存IG手法の2つの主要な問題（アトリビューションノイズと任意のベースライン選択）を解決し、複数のデータセットとタスクで、既存手法を上回る性能を示しています。この論文の影響は大きく、今後の研究において、より正確なアトリビューション手法の開発が期待されます。
