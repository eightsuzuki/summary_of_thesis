# ComplEx: 知識グラフ埋め込みのための複素埋め込み

**著者**:
* Théo Trouillon
* Johannes Welbl
* Sebastian Riedel
* Éric Gaussier
* Hervé Blondel

**出版**: International Conference on Machine Learning (ICML 2016)
**arXiv**: [arXiv:1606.06576](https://arxiv.org/pdf/1606.06576) (論文名："Complex Embeddings for Learning Knowledge Graph Relations")

---

### 概要

この論文では、知識グラフ（Knowledge Graph, KG）のエンティティと関係を**複素ベクトル空間**に埋め込む新しいモデル「ComplEx」が提案されています。先行するDistMultモデルは対称的な関係のモデリングに優れていましたが、非対称な関係を適切に扱えないという課題がありました。ComplExは、DistMultのシンプルさと計算効率を維持しつつ、複素数を用いることで、対称性、非対称性、反転性といった知識グラフの様々な関係パターンを同時に捕捉することを可能にしました。これにより、リンク予測などのタスクにおいて、既存の多くの最先端モデルを上回る性能を達成しています。

### 新規性

ComplExの最も重要な新規性は、**エンティティと関係を実数ベクトル空間ではなく、複素ベクトル空間に埋め込む**という点にあります。この複素数表現の導入により、DistMultが抱えていた非対称関係のモデリング能力の欠如を克服し、知識グラフのより広範な関係パターンを統一的に扱えるようになりました。

1.  **非対称関係の克服**:
    * DistMultのような実数ベースのモデルでは、$f(h, r, t) = f(t, r, h)$ となりがちで、対称的な関係しか本質的に表現できませんでした。これは、非対称な関係（例：「親」と「子」、「〜の創設者」など）が多数存在する現実の知識グラフのモデリングにおいて大きな制約となります。
    * ComplExは、複素数空間における内積を用いることで、自然に非対称性を表現できるようになりました。複素数の積の性質により、$\text{Re}(\mathbf{h} \circ \mathbf{r} \circ \overline{\mathbf{t}})$ は $\mathbf{h}$ と $\mathbf{t}$ の順番が入れ替わると値が変わるため、非対称な関係を捉えることができます。

2.  **関係パターンの統一的モデリング**:
    * ComplExは、対称性（Symmetry）、非対称性（Antisymmetry）、反転性（Inversion）といった主要な関係パターンを、単一のモデルで統一的に学習し、表現できることを示しました。特に、DistMultが対称関係に強い一方、TransEが非対称関係にも対応できるというそれぞれの強みを統合し、さらに優れたモデリング能力を提供します。

3.  **計算効率と表現能力のバランス**:
    * DistMultのシンプルさと計算効率の良い構造を維持しつつ、表現能力を向上させています。パラメータ数はDistMultの2倍になりますが、それでも他の複雑なモデルに比べて効率的であり、大規模な知識グラフにもスケーラブルに適用可能です。

### 理論/手法の核心

ComplExモデルでは、各エンティティ $e \in \mathcal{E}$ と各関係 $r \in \mathcal{L}$ を、**複素ベクトル空間** $\mathbb{C}^k$ に埋め込みます。つまり、各埋め込みベクトルは実部と虚部を持ちます。

* エンティティの埋め込み: $\mathbf{e} = \text{Re}(\mathbf{e}) + i \cdot \text{Im}(\mathbf{e}) \in \mathbb{C}^k$
* 関係の埋め込み: $\mathbf{r} = \text{Re}(\mathbf{r}) + i \cdot \text{Im}(\mathbf{r}) \in \mathbb{C}^k$
    ここで、$\text{Re}(\cdot)$ は実部、$\text{Im}(\cdot)$ は虚部を表します。

1.  **スコアリング関数**:
    * トリプル $(h, r, t)$ の妥当性スコア $f(h, r, t)$ は、ヘッドエンティティ $\mathbf{h}$、関係 $\mathbf{r}$、テールエンティティ $\mathbf{t}$ の複素共役 $\overline{\mathbf{t}}$ の要素ごとの積（アダマール積、または要素ごとの積 $\circ$）の実部として定義されます。

    $$
    f(h, r, t) = \text{Re}(\langle \mathbf{h}, \mathbf{r}, \overline{\mathbf{t}} \rangle) = \text{Re}\left( \sum_{j=1}^k h_j \cdot r_j \cdot \overline{t_j} \right)
    $$
    ここで、
    * $\langle \mathbf{h}, \mathbf{r}, \overline{\mathbf{t}} \rangle$ は、三つの複素ベクトルの「エルミート積（Hermitian product）」の一種と見なすことができます。
    * $\mathbf{h}_j, \mathbf{r}_j, \overline{\mathbf{t}_j}$ は、それぞれの複素ベクトル $\mathbf{h}, \mathbf{r}, \overline{\mathbf{t}}$ の $j$ 番目の要素です。
    * $\overline{\mathbf{t}}$ はベクトル $\mathbf{t}$ の複素共役であり、$\overline{\mathbf{t}_j} = \text{Re}(\mathbf{t}_j) - i \cdot \text{Im}(\mathbf{t}_j)$ です。
    * スコアが高いほど、トリプルが正しい確率が高いとみなされます。

    このスコアリング関数を展開すると、実数部と虚数部を用いて以下のように書けます。
    $$
    f(h, r, t) = \sum_{j=1}^k \left( \text{Re}(h_j) \text{Re}(r_j) \text{Re}(t_j) + \text{Im}(h_j) \text{Im}(r_j) \text{Re}(t_j) + \text{Re}(h_j) \text{Im}(r_j) \text{Im}(t_j) - \text{Im}(h_j) \text{Re}(r_j) \text{Im}(t_j) \right)
    $$
    この複雑な形式により、非対称な相互作用を捕捉できるようになります。

2.  **損失関数**:
    * 学習は、正例のスコアを最大化し、負例のスコアを最小化する目的で、ロジスティック損失（またはマージンベースのランキング損失）を用いて行われます。DistMultと同様に、正例を1、負例を0として二項分類問題として捉え、以下のような損失関数を最小化します。

    $$
    \mathcal{L} = - \sum_{(h,r,t) \in S \cup S'} \left[ y_{(h,r,t)} \log(\sigma(f(h,r,t))) + (1-y_{(h,r,t)}) \log(1 - \sigma(f(h,r,t))) \right]
    $$
    * $S$: 正しいトリプルのセット。
    * $S'$: 破損した（負例の）トリプルのセット。
    * $y_{(h,r,t)}$: トリプル $(h,r,t)$ が正例であれば1、負例であれば0となるラベル。
    * $\sigma(x) = 1 / (1 + \exp(-x))$: シグモイド関数。

3.  **制約**:
    * エンティティおよび関係の埋め込みベクトル（実部と虚部）に対して、L2ノルムが1以下であるという制約 $||v||_2 \le 1$ が課せられることがあります。これは、埋め込み空間のスケールを安定させ、オーバーフィッティングを防ぐために重要です。

### 「キモ」と重要性

ComplExの「キモ」は、**複素ベクトル空間にエンティティと関係を埋め込み、複素数を用いた内積によってトリプルの妥当性を評価する**という点にあります。これにより、従来のモデルでは表現が困難だった非対称な関係性を自然にモデリングできる能力を獲得しました。

このアイデアの重要性は以下の点に集約されます。

* **非対称関係の強力なモデリング**: 従来のDistMultが対称関係に特化していたのに対し、ComplExは複素数表現の特性を活かし、非対称関係を極めて効果的に捉えることができます。これは、現実世界の知識グラフに多数存在する非対称な関係を扱う上で不可欠な機能であり、モデルの適用範囲を大きく広げました。
* **関係パターンの包括的な捕捉**: ComplExは、対称性、非対称性、および反転性といった知識グラフにおける重要な関係パターンを、単一の統一されたフレームワーク内で学習・表現できる能力を持っています。これにより、より複雑な推論タスクや知識補完タスクにおいて、高い性能を発揮します。
* **シンプルさと高性能の両立**: DistMultと同様に三線形積の形式を基盤としているため、モデル構造は比較的シンプルでありながら、複素数の導入により大幅な表現能力の向上を実現しました。これにより、計算効率を大きく損なうことなく、リンク予測などのタスクで既存の最先端モデルを凌駕する結果を達成しました。
* **知識グラフ埋め込み研究の進展**: ComplExは、複素数空間を利用するという新しいアプローチを示し、その後の知識グラフ埋め込み研究に大きな影響を与えました。特に、RotatE（関係を複素数空間での回転としてモデル化）など、複素数やクォータニオンなどのより高次元の代数構造を活用するモデルの開発の道を切り開きました。

ComplExは、その優れた表現能力と計算効率のバランスにより、知識グラフの補完や推論のための強力なツールとして広く認識され、この分野における重要なベンチマークモデルの一つとなっています。
