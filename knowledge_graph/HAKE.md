# HAKE: 階層認識型知識グラフ埋め込み

**著者**:
* Zhanqiu Zhang (University of Science and Technology of China)
* Jianyu Cai (University of Science and Technology of China)
* Yongdong Zhang (University of Science and Technology of China)
* Jie Wang (University of Science and Technology of China)

**出版**: AAAI Conference on Artificial Intelligence (AAAI 2020)
**arXiv**: [arXiv:1911.09419](https://arxiv.org/abs/1911.09419)

---

### 概要

この論文では、知識グラフ（Knowledge Graph, KG）における**セマンティックな階層構造を自動的かつ効果的にモデル化する**ための新しい埋め込みモデル「HAKE（Hierarchy-Aware Knowledge Graph Embedding）」が提案されています。多くの既存の知識グラフ埋め込み手法は、実世界の知識グラフに頻繁に存在するセマンティックな階層を十分に捉えることができませんでした。HAKEは、エンティティを**極座標系（polar coordinate system）**にマッピングすることで、階層の異なるレベルにあるエンティティを動径座標（距離）で、同じレベルにあるエンティティを角度座標で区別します。これにより、知識グラフ内のセマンティックな階層を効果的にモデル化し、リンク予測タスクにおいて既存の最先端手法を大幅に上回る性能を達成しました。

### 新規性

HAKEの最も重要な新規性は、**知識グラフ内のセマンティックな階層構造を極座標系において明示的にモデル化した**点にあります。このアプローチにより、既存の埋め込みモデルが階層関係を扱う際に直面していた課題を解決しました。

1.  **極座標系による階層の自然な反映**:
    * HAKEは、極座標系における**同心円**が階層を自然に反映できるという事実に着想を得ています。
    * 具体的には、エンティティの**動径座標（距離）**が階層の異なるレベルにあるエンティティをモデル化することを目指し、動径座標が小さいエンティティほど高いレベル（より抽象的）にあると想定します。
    * **角度座標**は、階層の同じレベルにあるエンティティを区別することを目指し、これらのエンティティはおおよそ同じ動径座標を持ちつつ異なる角度を持つと想定します。
    * このように、HAKEはエンティティを動径座標（モジュラス情報）と角度座標（位相情報）を組み合わせて極座標系にマッピングします。

2.  **階層構造の自動学習と外部情報不要**:
    * HAKEは、クラスタリングアルゴリズムや、トリプル以外の追加情報（例：カテゴリ情報、タイプ情報）を使用することなく、知識グラフ内のセマンティックな階層を自動的に学習することができます。これは、データセットの準備が容易であり、汎用性が高いことを意味します。

3.  **表現能力と性能の向上**:
    * 階層情報を明示的にモデル化することで、TransEやRotatEなどの先行モデルでは難しかった、エンティティ間の包含関係や抽象度の違いをより正確に捉えることが可能になりました。
    * ベンチマークデータセットでのリンク予測タスクにおいて、既存の最先端手法を大幅に上回る性能を示しました。

### 理論/手法の核心

HAKEモデルでは、各エンティティ $e$ を $k$ 次元の**極座標ベクトル**として埋め込みます。この埋め込みは、動径座標（モジュラス）$\boldsymbol{\rho}_e \in \mathbb{R}^k$ と角度座標（位相）$\boldsymbol{\theta}_e \in \mathbb{R}^k$ の2つの実数ベクトルから構成されます。同様に、各関係 $r$ も関係の動径ベクトル $\mathbf{r}_{\rho} \in \mathbb{R}^k$ と関係の角度ベクトル $\mathbf{r}_{\theta} \in \mathbb{R}^k$ で表現されます。

1.  **スコアリング関数**:
    * トリプル $(h, r, t)$ の妥当性スコア $f(h, r, t)$ は、ヘッドエンティティの動径 $\boldsymbol{\rho}_h$ と角度 $\boldsymbol{\theta}_h$ を関係の動径 $\mathbf{r}_{\rho}$ と角度 $\mathbf{r}_{\theta}$ で変換した結果が、テールエンティティの動径 $\boldsymbol{\rho}_t$ と角度 $\boldsymbol{\theta}_t$ にどれだけ近いかを示す距離として定義されます。

    $$
    f(h, r, t) = ||\boldsymbol{\rho}_h \circ \mathbf{r}_{\rho} - \boldsymbol{\rho}_t||_1 + ||\boldsymbol{\theta}_h + \mathbf{r}_{\theta} - \boldsymbol{\theta}_t||_1
    $$
    ここで、
    * $\circ$ はアダマール積（要素ごとの積）を表します。これは、ヘッドエンティティの動径が関係の動径によってスケーリングされることを意味します。
    * $||\cdot||_1$ はL1ノルムです。
    * スコアが小さいほど、トリプルが正しい確率が高いとみなされます。

2.  **階層関係のモデリング**:
    * **動径座標**: HAKEは、階層において上位の概念（より抽象的）がより小さい動径を持つように学習します。関係 $\mathbf{r}_{\rho}$ の各要素は $0 < r_{\rho, j} < 1$ に制約されることで、ヘッドからテールへの変換が動径を減少させ、階層の下位方向への移動を表現します。
    * **角度座標**: 角度は $2\pi$ の周期性を持つため、角度の差分は $2\pi$ の剰余（modulo $2\pi$）で計算されます。これにより、同一階層レベル内のエンティティ間の関係を効果的にモデル化できます。

3.  **損失関数**:
    * 学習は、正例のスコアを最大化し、負例のスコアを最小化する目的で、マージンベースのランキング損失関数を用いて行われます。また、RotatEで導入された**自己対立的負例サンプリング**も活用されます。

    $$
    \mathcal{L} = - \sum_{(h,r,t) \in S^+} \log \sigma(\gamma - f(h,r,t)) - \sum_{(h_i',r_i',t_i') \in S^-} p(h_i',r_i',t_i') \log \sigma(f(h_i',r_i',t_i') - \gamma)
    $$
    ここで、
    * $S^+$: 正しいトリプルのセット。
    * $S^-$: 負例のトリプルのセット。
    * $\gamma$: マージン。
    * $\sigma(\cdot)$: シグモイド関数。
    * $p(\cdot)$: 自己対立的負例サンプリングにおける負例の確率分布。モデルのスコアに基づいて動的に調整されます。

4.  **エンティティと関係の制約**:
    * エンティティの動径 $\boldsymbol{\rho}_e$ および関係の動径 $\mathbf{r}_{\rho}$ の各要素は正の値に制約されます。
    * エンティティの角度 $\boldsymbol{\theta}_e$ および関係の角度 $\mathbf{r}_{\theta}$ の各要素は $0$ から $2\pi$ の範囲に制約されます。

### 「キモ」と重要性

HAKEの「キモ」は、**知識グラフの階層構造を極座標系という直感的な幾何学的フレームワークに落とし込み、エンティティの「抽象度」を動径で、「概念空間内の位置」を角度で表現した**点にあります。これにより、階層関係を既存の埋め込みモデルよりも遥かに正確かつ自然にモデル化できる能力を獲得しました。

このアイデアの重要性は以下の点に集約されます。

* **階層構造の明示的かつ効果的なモデリング**: HAKEは、知識グラフの階層的セマンティクスを直接的に学習できる最初の成功したモデルの一つです。これにより、「is-a」や「part-of」のような包含関係や抽象度の違いを伴う関係が、モデルの埋め込み空間に明確に反映されるようになりました。
* **より高精度な知識グラフ補完**: 階層情報を正確に捉えることで、リンク予測や関係推論などのタスクにおいて、既存のSOTAモデルを大幅に上回る性能を達成しました。特に、階層関係が豊富なデータセットでその強みを発揮します。
* **汎用性と自動学習**: クラスタリングや追加情報なしに階層を自動的に学習できるため、幅広い知識グラフに適用可能です。
* **新しいモデル設計の方向性**: HAKEは、知識グラフの特定の構造的特性（この場合は階層）に焦点を当て、それを幾何学的にモデル化するという新しいアプローチを示しました。これは、今後の知識グラフ埋め込みモデルの設計において、より複雑な関係パターンや構造を捉えるためのインスピレーションを提供しました。

HAKEは、知識グラフにおける階層構造の重要性を強調し、それを効果的にモデル化する新しい手段を提供した点で、知識グラフ埋め込み分野の重要な進歩を示す論文であると言えます。