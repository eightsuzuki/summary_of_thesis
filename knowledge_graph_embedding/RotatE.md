# RotatE: 知識グラフ埋め込みにおける関係の回転

**著者**:
* Zhiqing Sun (Peking University, China)
* Zhi-Hong Deng (Peking University, China)
* Jian-Yun Nie (Peking University, China)
* Jian Tang (Peking University, China)

**出版**: International Conference on Learning Representations (ICLR 2019)
**arXiv**: [arXiv:1902.10197](https://arxiv.org/pdf/1902.10197)

---

### 概要

この論文では、知識グラフ（Knowledge Graph, KG）のエンティティと関係を複素ベクトル空間に埋め込むための新しいモデル「RotatE（Relations as Rotations in Complex Space）」が提案されています。RotatEは、先行モデルであるTransE（並進）やComplEx（複素数空間での線形結合）とは異なり、関係を**複素ベクトル空間におけるヘッドエンティティからテールエンティティへの「回転」**としてモデル化します。この回転操作により、対称性、非対称性、反転性といった知識グラフにおける重要な関係パターンを自然かつ統一的に捕捉できることを示しています。特に、一貫性のある関係パターンを明示的に学習できるため、リンク予測や関係推論などのタスクで既存の最先端モデルを大幅に上回る性能を達成しました。

### 新規性

RotatEの最も重要な新規性は、**関係を複素ベクトル空間におけるエンティティ埋め込みの「回転」として厳密にモデル化した**点にあります。この幾何学的変換の導入により、知識グラフの多様な関係パターンを非常に洗練された方法で表現できるようになりました。

1.  **幾何学的な直感と表現力**:
    * TransEは並進を、DistMult/ComplExは積（線形結合）を基本としていましたが、RotatEは「回転」という新しい幾何学的な操作を導入しました。この回転の概念は、特に反転性を持つ関係（例：「親」と「子」）を自然に表現できるという点で強力です。
    * 複素数空間での回転は、各次元においてエンティティの埋め込みを関係の位相（角度）だけ回転させることを意味し、これにより対称性、非対称性、および反転性の関係を統一的に扱うことができます。

2.  **関係パターンの明示的なモデリング能力**:
    * **対称性**: 関係 $r$ の位相が0または $\pi$ の場合、$\mathbf{h}$ を回転させると $\mathbf{t}$ と $\mathbf{h}$ の実数部と虚数部の相対的な符号が一致または反転し、対称的な関係を表現できます。
    * **非対称性**: 一般的な関係は非対称にモデル化され、$\mathbf{h}$ と $\mathbf{t}$ の間に方向性のある回転が存在します。
    * **反転性**: 関係 $r'$ が関係 $r$ の逆関係である場合（例：「子」は「親」の逆）、$\mathbf{r}' = \overline{\mathbf{r}}$（共役）とすることで、$\mathbf{h} \circ \mathbf{r} \approx \mathbf{t}$ ならば $\mathbf{t} \circ \overline{\mathbf{r}} \approx \mathbf{h}$ が成立し、関係の逆転を自然に捉えることができます。これはTransEが苦手とした点です。
    * **合成性**: 関係 $r_1$ と $r_2$ の合成関係 $r_3$（例：「祖父」は「父」の「父」）を $\mathbf{r}_3 = \mathbf{r}_1 \circ \mathbf{r}_2$ として表現できる可能性も示唆しています。

3.  **負例サンプリング戦略の改善**:
    * 既存の負例サンプリング手法が、学習プロセスで生成される負例の品質に大きく依存している点を指摘し、より洗練された「自己対立的負例サンプリング（self-adversarial negative sampling）」を導入しました。これにより、ハードな負例を効率的に生成し、モデルの学習を安定させ、性能を向上させています。

### 理論/手法の核心

RotatEモデルでは、各エンティティ $e \in \mathcal{E}$ と各関係 $r \in \mathcal{L}$ を、**複素ベクトル空間** $\mathbb{C}^k$ に埋め込みます。

1.  **スコアリング関数**:
    * トリプル $(h, r, t)$ の妥当性スコア $f(h, r, t)$ は、ヘッドエンティティの埋め込み $\mathbf{h} \in \mathbb{C}^k$ を関係の埋め込み $\mathbf{r} \in \mathbb{C}^k$ で要素ごとに回転させた結果が、テールエンティティの埋め込み $\mathbf{t} \in \mathbb{C}^k$ にどれだけ近いかを示す距離として定義されます。

    $$
    f(h, r, t) = ||\mathbf{h} \circ \mathbf{r} - \mathbf{t}||_{L_1/L_2}
    $$
    ここで、
    * $\circ$ はアダマール積（要素ごとの積）を表します。
    * $\mathbf{h} \circ \mathbf{r}$ は、各次元 $j$ において $h_j \cdot r_j$ と計算されます。
    * $h_j, r_j$ は複素数であり、$h_j = |h_j| e^{i \theta_{h_j}}$、$r_j = |r_j| e^{i \theta_{r_j}}$ と極形式で表現できるため、$h_j \cdot r_j = |h_j||r_j| e^{i (\theta_{h_j} + \theta_{r_j})}$ となり、これは $h_j$ を $\theta_{r_j}$ だけ回転させる操作と解釈できます。
    * $L_1$ または $L_2$ ノルムが距離測度として使用されます。
    * スコアが小さいほど、トリプルは正しい確率が高いとみなされます。

2.  **制約**:
    * 関係の埋め込みベクトル $\mathbf{r}$ の各要素は、その絶対値が1であるという制約 $|r_j| = 1$ が課せられます。これは、$\mathbf{r}$ が純粋な回転として機能し、埋め込みベクトルのノルムを変化させないようにするためです。
    * エンティティの埋め込みベクトル $\mathbf{h}, \mathbf{t}$ には、L2ノルムが1であるという制約 $||v||_2 = 1$ が課せられることがあります。

3.  **損失関数（自己対立的負例サンプリング付きロジスティック損失）**:
    * RotatEは、従来の負例サンプリングの限界を克服するため、「自己対立的負例サンプリング」という新しいサンプリング戦略を導入しました。これは、モデルが困難な負例（つまり、正例に近いが実際には負例であるもの）を動的に生成し、それらに高い重みを与えることで学習を効率化します。
    * 損失関数は、ロジスティック損失とこの自己対立的サンプリングを組み合わせたものです。

    $$
    \mathcal{L} = - \sum_{(h,r,t) \in S^+} \log \sigma(\gamma - f(h,r,t)) - \sum_{(h_i',r_i',t_i') \in S^-} p(h_i',r_i',t_i') \log \sigma(f(h_i',r_i',t_i') - \gamma)
    $$
    ここで、
    * $S^+$: 正しいトリプルのセット。
    * $S^-$: 負例のトリプルのセット。
    * $\gamma$: マージン。
    * $\sigma(\cdot)$: シグモイド関数。
    * $p(h_i',r_i',t_i')$: 負例 $(h_i',r_i',t_i')$ がサンプリングされる確率で、モデルのスコアに基づいて動的に決定されます。具体的には、温度パラメータ $\alpha$ を用いてsoftmax正規化されたスコアの確率分布からサンプリングされます。
        $$
        p(h_i',r_i',t_i') = \frac{\exp(\alpha f(h_i',r_i',t_i'))}{\sum_j \exp(\alpha f(h_j',r_j',t_j'))}
        $$

### 「キモ」と重要性

RotatEの「キモ」は、**複素ベクトル空間における関係を、ヘッドエンティティをテールエンティティに変換する「回転」として厳密に定義した**点にあります。この幾何学的な解釈により、知識グラフの複雑な論理的関係パターンを、単一のモデルでエレガントに、かつ強力にモデル化することが可能になりました。

このアイデアの重要性は以下の点に集約されます。

* **論理的関係パターンの統一的・自然なモデリング**:
    * **対称性**: 位相が0または $\pi$ の関係で表現。
    * **非対称性**: 一般的な位相を持つ関係で表現。
    * **反転性**: 関係の複素共役で表現できる。これにより、「(A, is_father_of, B)」が真ならば「(B, is_child_of, A)」も真といった関係を自然に捉え、推論できる。
    * **合成性**: 回転の連続適用が回転の合成に対応するため、理論的には関係パスの合成性（例：「祖父」＝「父」 $\circ$ 「父」）も表現可能であり、多段階推論の基礎となり得ます。
* **負例サンプリングの革新**: 自己対立的負例サンプリングの導入は、知識グラフ埋め込みの学習プロセスにおいて、より有益で困難な負例を効率的に生成するための画期的な手法であり、モデルの頑健性と性能向上に大きく貢献しました。
* **圧倒的な性能向上**: 知識グラフのリンク予測や関係推論などのタスクにおいて、既存のTransE、ComplEx、DistMultといった最先端モデルを大きく上回る性能を達成しました。これにより、RotatEは、知識グラフ埋め込み研究の新たな基準を確立しました。
* **深層学習との連携**: 複素数空間での操作は、深層学習モデルとの統合も容易であり、より複雑な知識表現学習の道を開きました。

RotatEは、その洗練された理論的基盤と優れた実証結果により、知識グラフ埋め込み分野におけるマイルストーンとなるモデルであり、その後の研究に多大な影響を与えています。
